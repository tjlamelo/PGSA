@{ Layout = null; }

<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - PGSA Université Saint Jean</title>

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <!-- Google Fonts - Poppins -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Site CSS -->
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link
      rel="stylesheet"
      href="~/css/dashboard.css"
      asp-append-version="true"
    />
    <link
      rel="stylesheet"
      href="~/PGSA_Licence3.styles.css"
      asp-append-version="true"
    />
  </head>

  <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-custom fixed-top">
      <button class="sidebar-toggle-btn" id="sidebarToggle">
        <i class="bi bi-list"></i>
      </button>

      <a class="navbar-brand d-flex align-items-center" href="#">
        <div class="university-logo">ISJ</div>
        PGSA - Université Saint Jean
      </a>

      <button
        class="navbar-toggler border-0"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarAdmin"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarAdmin">
        <ul class="navbar-nav ms-auto">
          <!-- Notifications -->
          <li class="nav-item dropdown">
            <a
              class="nav-link notification-icon"
              href="#"
              id="notificationDropdown"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <i class="bi bi-bell"></i>
              <span class="notification-badge">3</span>
            </a>
            <ul
              class="dropdown-menu dropdown-menu-end notification-dropdown"
              aria-labelledby="notificationDropdown"
            >
              <div class="notification-header">
                <span>Notifications</span>
                <a href="#" class="text-primary">Marquer tout comme lu</a>
              </div>
              <div class="notification-list">
                <div class="notification-item">
                  <div class="notification-icon-item danger">
                    <i class="bi bi-exclamation-triangle"></i>
                  </div>
                  <div class="notification-content">
                    <div class="notification-title">
                      Absence enseignant signalée
                    </div>
                    <div class="notification-message">
                      M. Dupont est absent pour le cours de Mathématiques
                    </div>
                    <div class="notification-time">Il y a 10 minutes</div>
                  </div>
                </div>
                <div class="notification-item">
                  <div class="notification-icon-item warning">
                    <i class="bi bi-clock-history"></i>
                  </div>
                  <div class="notification-content">
                    <div class="notification-title">Validation en attente</div>
                    <div class="notification-message">
                      3 séances en attente de validation
                    </div>
                    <div class="notification-time">Il y a 1 heure</div>
                  </div>
                </div>
                <div class="notification-item">
                  <div class="notification-icon-item success">
                    <i class="bi bi-check-circle"></i>
                  </div>
                  <div class="notification-content">
                    <div class="notification-title">
                      Justification approuvée
                    </div>
                    <div class="notification-message">
                      La justification de Martin Pierre a été approuvée
                    </div>
                    <div class="notification-time">Il y a 2 heures</div>
                  </div>
                </div>
              </div>
              <div class="notification-footer">
                <a href="#">Voir toutes les notifications</a>
              </div>
            </ul>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="/">
              <i class="bi bi-house-door me-1"></i> Accueil
            </a>
          </li>

          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle d-flex align-items-center"
              href="#"
              id="userDropdown"
              role="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <div class="user-profile">
                <img
                  src="https://picsum.photos/seed/admin/100/100.jpg"
                  alt="Admin"
                />
      <span>@User.Identity?.Name</span>

              </div>
            </a>
            <ul
              class="dropdown-menu dropdown-menu-end"
              aria-labelledby="userDropdown"
            >
              <li>
                <a class="dropdown-item" href="/Profile"
                  ><i class="bi bi-person"></i> Mon profil</a
                >
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a class="dropdown-item" href="/Logout">
                  <i class="bi bi-box-arrow-right"></i> Déconnexion
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </nav>

    <!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h5>
            <i class="bi bi-grid-3x3-gap-fill me-2"></i>
            MENU PGSA
        </h5>
        <button class="sidebar-toggle" id="desktopSidebarToggle">
            <i class="bi bi-chevron-left"></i>
        </button>
    </div>

    <ul class="sidebar-menu">

        <!-- Dashboard : visible pour tous les rôles -->
        <li>
            <a href="/dashboard/index" data-tooltip="Gestion des utilisateurs">
                <i class="bi bi-people"></i>
                <span class="menu-text">Dashboard</span>
            </a>
        </li>

        <!-- Justification Absences : seulement Administrateur et Délégué -->
        @if (User.IsInRole("Administrateur") || User.IsInRole("Délégué") || User.IsInRole("Etudiant"))
        {
            <li>
                <a href="/JustificationAbsences" data-tooltip="Justifications d'absences">
                    <i class="bi bi-people"></i>
                    <span class="menu-text">Justification Absences</span>
                </a>
            </li>
        }

        <!-- Gestion utilisateurs : seulement pour Administrateur -->
        @if (User.IsInRole("Administrateur"))
        {                  
            <li>
                <a href="/Admin/UserManagement/Account" data-tooltip="Gestion des utilisateurs">
                    <i class="bi bi-people"></i>
                    <span class="menu-text">Gestion des utilisateurs</span>
                </a>
            </li>

            <li>
                <a href="/Admin/Permissions" data-tooltip="Gestion des permissions">
                    <i class="bi bi-people"></i>
                    <span class="menu-text">Gestion des permissions</span>
                </a>
            </li>

            <li>
                <a href="/Students/Import" data-tooltip="Import des étudiants">
                    <i class="bi bi-upload"></i>
                    <span class="menu-text">Import étudiants</span>
                </a>
            </li>
        }

        <!-- Séances et Prise d'appel : Administrateur, Enseignant, Délégué -->
        @if (User.IsInRole("Administrateur") || User.IsInRole("Enseignant") || User.IsInRole("Délégué"))
        {
            <li>
                <a href="/Seance" data-tooltip="Gestion des séances">
                    <i class="bi bi-calendar-plus"></i>
                    <span class="menu-text">Séances</span>
                </a>
            </li>

            <li>
                <a href="/Assiduite/PriseAppel" data-tooltip="Prise d'appel">
                    <i class="bi bi-check2-square"></i>
                    <span class="menu-text">Prise d'appel</span>
                </a>
            </li>

            <li>
                <a href="/CahierDeTexte" data-tooltip="Cahier de texte">
                    <i class="bi bi-journal-text"></i>
                    <span class="menu-text">Cahier de texte</span>
                </a>
            </li>

            <li>
                <a href="/ValidationSeance" data-tooltip="Validation des séances">
                    <i class="bi bi-clipboard-check"></i>
                    <span class="menu-text">Validation séances</span>
                </a>
            </li>
        }

        <!-- Absence enseignant : Administrateur et Délégué uniquement -->
        @if (User.IsInRole("Administrateur") || User.IsInRole("Délégué"))
        {
            <li>
                <a href="/SignalementAbsenceEnseignant" data-tooltip="Signalement des absences enseignants">
                    <i class="bi bi-exclamation-triangle"></i>
                    <span class="menu-text">Absence enseignant</span>
                </a>
            </li>
        }
    </ul>
</div>


    <!-- CONTENU -->
    <div class="content" id="content">
      <!-- Breadcrumb Dynamique -->
      <div class="breadcrumb-container">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">Accueil</a></li>
            @if (ViewData["Breadcrumb"] != null) { var breadcrumb =
            ViewData["Breadcrumb"] as List<(string Text, string Url)>; if
            (breadcrumb != null) { for (int i = 0; i < breadcrumb.Count; i++) {
            if (i < breadcrumb.Count - 1) {
            <li class="breadcrumb-item">
              <a href="@breadcrumb[i].Url">@breadcrumb[i].Text</a>
            </li>
            } else {
            <li class="breadcrumb-item active" aria-current="page">
              @breadcrumb[i].Text
            </li>
            } } } } else {
            <li class="breadcrumb-item active" aria-current="page">
              @ViewData["Title"]
            </li>
            }
          </ol>
        </nav>
      </div>

      @RenderBody()
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const sidebar = document.getElementById("sidebar");
        const content = document.getElementById("content");
        const navbar = document.querySelector(".navbar-custom");
        const desktopSidebarToggle = document.getElementById(
          "desktopSidebarToggle"
        );
        const sidebarToggle = document.getElementById("sidebarToggle");
        const desktopToggleIcon = desktopSidebarToggle.querySelector("i");

        // Toggle sidebar pour desktop
        desktopSidebarToggle.addEventListener("click", function () {
          sidebar.classList.toggle("collapsed");
          content.classList.toggle("expanded");
          navbar.classList.toggle("expanded");

          // Changer l'icône du bouton
          if (sidebar.classList.contains("collapsed")) {
            desktopToggleIcon.classList.remove("bi-chevron-left");
            desktopToggleIcon.classList.add("bi-chevron-right");
          } else {
            desktopToggleIcon.classList.remove("bi-chevron-right");
            desktopToggleIcon.classList.add("bi-chevron-left");
          }
        });

        // Toggle sidebar pour mobile et desktop via le bouton dans la navbar
        sidebarToggle.addEventListener("click", function () {
          sidebar.classList.toggle("collapsed");
          content.classList.toggle("expanded");
          navbar.classList.toggle("expanded");

          // Changer l'icône du bouton
          if (sidebar.classList.contains("collapsed")) {
            desktopToggleIcon.classList.remove("bi-chevron-left");
            desktopToggleIcon.classList.add("bi-chevron-right");
          } else {
            desktopToggleIcon.classList.remove("bi-chevron-right");
            desktopToggleIcon.classList.add("bi-chevron-left");
          }

          // Pour mobile, on ajoute la classe active pour afficher la sidebar
          if (window.innerWidth <= 992) {
            sidebar.classList.toggle("active");
          }
        });

        // Fermer la sidebar en cliquant à l'extérieur sur mobile
        document.addEventListener("click", function (event) {
          if (window.innerWidth <= 992) {
            if (
              !sidebar.contains(event.target) &&
              !sidebarToggle.contains(event.target) &&
              sidebar.classList.contains("active")
            ) {
              sidebar.classList.remove("active");
            }
          }
        });

        // Gérer le redimensionnement de la fenêtre
        window.addEventListener("resize", function () {
          if (window.innerWidth > 992) {
            sidebar.classList.remove("active");
          }
        });

        // Activer le lien de menu actif
        const currentLocation = window.location.pathname;
        const menuLinks = document.querySelectorAll(".sidebar-menu a");

        menuLinks.forEach((link) => {
          if (link.getAttribute("href") === currentLocation) {
            link.classList.add("active");
          } else {
            link.classList.remove("active");
          }
        });

        // Gestion des sous-menus
        const submenuItems = document.querySelectorAll(".has-submenu > a");

        submenuItems.forEach((item) => {
          item.addEventListener("click", function (e) {
            e.preventDefault();
            const parent = this.parentElement;
            const submenu = parent.querySelector(".sidebar-submenu");

            parent.classList.toggle("open");
            submenu.classList.toggle("show");
          });
        });
      });
    </script>
    @RenderSection("Scripts", required: false)
  </body>
</html>
